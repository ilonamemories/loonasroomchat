<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loona's room - Connect & Create Together</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Poppins', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #ffeef8 0%, #ffe4f1 50%, #fff9e6 100%);
        }
        
        .pastel-pink {
            background: linear-gradient(135deg, #ffb3d9 0%, #ffc9e3 100%);
        }
        
        .pastel-yellow {
            background: linear-gradient(135deg, #fff2b3 0%, #ffe680 100%);
        }
        
        .pastel-peach {
            background: linear-gradient(135deg, #ffd4d4 0%, #ffb3d9 100%);
        }
        
        .cute-shadow {
            box-shadow: 0 8px 25px rgba(255, 182, 193, 0.3);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.35);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 192, 203, 0.3);
            border-radius: 25px;
        }
        
        .floating-emoji {
            position: fixed;
            font-size: 1.5rem;
            pointer-events: none;
            z-index: 10;
            animation: floatEmoji 8s ease-in-out infinite;
        }
        
        @keyframes floatEmoji {
            0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.7; }
            25% { transform: translateY(-20px) rotate(5deg); opacity: 1; }
            50% { transform: translateY(-10px) rotate(-3deg); opacity: 0.8; }
            75% { transform: translateY(-15px) rotate(2deg); opacity: 0.9; }
        }
        
        .floating {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .pulse-glow {
            animation: pulse-glow 2s infinite;
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 182, 193, 0.6); }
            50% { box-shadow: 0 0 35px rgba(255, 182, 193, 0.9); }
        }
        
        .bouncy {
            animation: bounce 2s ease-in-out infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0px) scale(1); }
            50% { transform: translateY(-5px) scale(1.05); }
        }
        
        .chat-bubble {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .hidden { display: none; }
        
        .easter-egg {
            position: fixed;
            font-size: 2rem;
            pointer-events: none;
            z-index: 1000;
            animation: sparkle 2s ease-out forwards;
        }
        
        @keyframes sparkle {
            0% { opacity: 1; transform: scale(0) rotate(0deg); }
            50% { opacity: 1; transform: scale(1.2) rotate(180deg); }
            100% { opacity: 0; transform: scale(0.8) rotate(360deg); }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Login Page -->
    <div id="loginPage" class="min-h-screen flex items-center justify-center p-4 relative overflow-hidden">
        <!-- Floating Background Emojis -->
        <div class="floating-emoji" style="top: 10%; left: 15%; animation-delay: 0s;">🌸</div>
        <div class="floating-emoji" style="top: 20%; right: 20%; animation-delay: 1s;">🦋</div>
        <div class="floating-emoji" style="bottom: 30%; left: 10%; animation-delay: 2s;">🌙</div>
        <div class="floating-emoji" style="top: 60%; right: 15%; animation-delay: 3s;">⭐</div>
        <div class="floating-emoji" style="bottom: 20%; right: 30%; animation-delay: 4s;">🌺</div>
        <div class="floating-emoji" style="top: 40%; left: 5%; animation-delay: 5s;">🎀</div>
        
        <div class="glass-effect cute-shadow p-8 w-full max-w-md relative">
            <div class="text-center mb-8">
                <div class="bouncy mb-4">
                    <div class="w-24 h-24 mx-auto pastel-pink rounded-full flex items-center justify-center text-5xl cute-shadow">
                        🌙
                    </div>
                </div>
                <h1 class="text-4xl font-bold text-pink-600 mb-2">Loona's room</h1>
                <p class="text-pink-400 flex items-center justify-center gap-2">
                    <span>Connect & Create Together</span> 
                    <span class="bouncy">✨</span>
                </p>
            </div>
            
            <form onsubmit="login(event)" class="space-y-6">
                <div class="relative">
                    <span class="absolute left-4 top-1/2 transform -translate-y-1/2 text-2xl">💌</span>
                    <input type="email" id="loginEmail" placeholder="Email kamu" required
                           class="w-full pl-12 pr-4 py-4 rounded-3xl bg-white/30 text-pink-700 placeholder-pink-400 border-2 border-pink-200 focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-pink-300 cute-shadow">
                </div>
                <div class="relative">
                    <span class="absolute left-4 top-1/2 transform -translate-y-1/2 text-2xl">🔐</span>
                    <input type="password" placeholder="Password" required
                           class="w-full pl-12 pr-4 py-4 rounded-3xl bg-white/30 text-pink-700 placeholder-pink-400 border-2 border-pink-200 focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-pink-300 cute-shadow">
                </div>
                <button type="submit" class="w-full py-4 pastel-pink rounded-3xl text-white font-semibold pulse-glow hover:scale-105 transition-all duration-300 cute-shadow flex items-center justify-center gap-2">
                    <span>Masuk ke Loona's room</span>
                    <span class="bouncy">🚀</span>
                </button>
            </form>
            
            <div class="text-center mt-6">
                <p class="text-pink-400 flex items-center justify-center gap-1">
                    <span>Belum punya akun?</span>
                    <span class="text-pink-600 cursor-pointer hover:text-pink-700 font-semibold transition-colors" onclick="showRegister()">Daftar yuk!</span>
                    <span class="bouncy">💕</span>
                </p>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden min-h-screen">
        <!-- Header -->
        <header class="glass-effect p-4 flex items-center justify-between cute-shadow">
            <div class="flex items-center space-x-4">
                <div class="w-14 h-14 pastel-pink rounded-full flex items-center justify-center text-3xl bouncy cute-shadow">🌙</div>
                <div>
                    <h1 class="text-2xl font-bold text-pink-600 flex items-center gap-2">
                        <span>Loona's room</span>
                        <span class="text-lg bouncy">✨</span>
                    </h1>
                    <p class="text-pink-400 text-sm flex items-center gap-1" id="userStatus">
                        <span class="bouncy">🟢</span>
                        <span>Online • <span id="currentUser"></span></span>
                    </p>
                </div>
            </div>
            <div class="flex items-center space-x-3">
                <button onclick="toggleSettings()" class="p-3 rounded-full pastel-yellow text-pink-600 hover:scale-110 transition-all duration-300 cute-shadow">⚙️</button>
                <button onclick="logout()" class="p-3 rounded-full pastel-peach text-pink-600 hover:scale-110 transition-all duration-300 cute-shadow">🚪</button>
            </div>
        </header>

        <div class="flex h-screen">
            <!-- Sidebar -->
            <div class="w-80 glass-effect p-4 space-y-4 cute-shadow">
                <!-- Friends List -->
                <div class="bg-white/20 rounded-3xl p-4 cute-shadow">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-pink-600 font-semibold flex items-center gap-2">
                            <span class="bouncy">👥</span>
                            <span>Teman-teman</span>
                        </h3>
                        <button onclick="showAddFriend()" class="text-2xl hover:scale-125 transition-transform bouncy pastel-yellow rounded-full p-2">➕</button>
                    </div>
                    <div id="friendsList" class="space-y-3">
                        <div class="flex items-center space-x-3 p-3 rounded-2xl bg-gradient-to-r from-purple-200/30 to-blue-200/30 hover:from-purple-200/40 hover:to-blue-200/40 cursor-pointer transition-all duration-300 hover:scale-105 cute-shadow border border-purple-300/20" onclick="startChat('Luna')">
                            <div class="w-12 h-12 bg-gradient-to-r from-purple-400 to-blue-400 rounded-full flex items-center justify-center text-xl bouncy">🤖</div>
                            <div class="flex-1">
                                <p class="text-pink-600 font-medium flex items-center gap-2">
                                    <span>Luna</span>
                                    <span class="text-xs bg-purple-200 text-purple-700 px-2 py-1 rounded-full">AI</span>
                                </p>
                                <p class="text-pink-400 text-sm flex items-center gap-1">
                                    <span class="bouncy">✨</span>
                                    <span>AI Assistant</span>
                                </p>
                            </div>
                            <div class="w-4 h-4 bg-blue-400 rounded-full bouncy"></div>
                        </div>
                        <div class="flex items-center space-x-3 p-3 rounded-2xl bg-white/20 hover:bg-white/30 cursor-pointer transition-all duration-300 hover:scale-105 cute-shadow" onclick="startChat('Sarah')">
                            <div class="w-12 h-12 pastel-pink rounded-full flex items-center justify-center text-xl bouncy">👩</div>
                            <div class="flex-1">
                                <p class="text-pink-600 font-medium">Sarah</p>
                                <p class="text-pink-400 text-sm flex items-center gap-1">
                                    <span class="bouncy">🌸</span>
                                    <span>Online</span>
                                </p>
                            </div>
                            <div class="w-4 h-4 bg-green-400 rounded-full bouncy"></div>
                        </div>
                        <div class="flex items-center space-x-3 p-3 rounded-2xl bg-white/20 hover:bg-white/30 cursor-pointer transition-all duration-300 hover:scale-105 cute-shadow" onclick="startChat('Alex')">
                            <div class="w-12 h-12 pastel-yellow rounded-full flex items-center justify-center text-xl bouncy">👨</div>
                            <div class="flex-1">
                                <p class="text-pink-600 font-medium">Alex</p>
                                <p class="text-pink-400 text-sm flex items-center gap-1">
                                    <span class="bouncy">🌙</span>
                                    <span>Away</span>
                                </p>
                            </div>
                            <div class="w-4 h-4 bg-yellow-400 rounded-full bouncy"></div>
                        </div>
                    </div>
                </div>

                <!-- Rooms -->
                <div class="bg-white/20 rounded-3xl p-4 cute-shadow">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-pink-600 font-semibold flex items-center gap-2">
                            <span class="bouncy">🏠</span>
                            <span>Room</span>
                        </h3>
                        <button onclick="createRoom()" class="text-2xl hover:scale-125 transition-transform bouncy pastel-peach rounded-full p-2">🏗️</button>
                    </div>
                    <div class="space-y-3">
                        <div class="p-3 rounded-2xl bg-white/20 hover:bg-white/30 cursor-pointer transition-all duration-300 hover:scale-105 cute-shadow" onclick="joinRoom('study')">
                            <p class="text-pink-600 font-medium flex items-center gap-2">
                                <span class="bouncy">📚</span>
                                <span>Study Group</span>
                            </p>
                            <p class="text-pink-400 text-sm flex items-center gap-1">
                                <span class="bouncy">✨</span>
                                <span>3 orang online</span>
                            </p>
                        </div>
                        <div class="p-3 rounded-2xl bg-white/20 hover:bg-white/30 cursor-pointer transition-all duration-300 hover:scale-105 cute-shadow" onclick="joinRoom('gaming')">
                            <p class="text-pink-600 font-medium flex items-center gap-2">
                                <span class="bouncy">🎮</span>
                                <span>Gaming Squad</span>
                            </p>
                            <p class="text-pink-400 text-sm flex items-center gap-1">
                                <span class="bouncy">🎯</span>
                                <span>5 orang online</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Chat Area -->
            <div class="flex-1 flex flex-col">
                <!-- Chat Header -->
                <div class="glass-effect p-4 flex items-center justify-between cute-shadow">
                    <div class="flex items-center space-x-3">
                        <div class="w-14 h-14 pastel-pink rounded-full flex items-center justify-center text-3xl bouncy cute-shadow" id="chatAvatar">👋</div>
                        <div>
                            <h2 class="text-pink-600 font-semibold flex items-center gap-2" id="chatTitle">
                                <span>Pilih teman untuk mulai chat!</span>
                                <span class="bouncy">💕</span>
                            </h2>
                            <p class="text-pink-400 text-sm flex items-center gap-1" id="chatStatus">
                                <span class="bouncy">🎉</span>
                                <span>Siap untuk ngobrol seru?</span>
                            </p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="text-center">
                            <button onclick="toggleVideo()" class="p-3 rounded-full pastel-pink text-white hover:scale-110 transition-all duration-300 cute-shadow" id="videoBtn">📹</button>
                            <p class="text-xs text-pink-400 mt-1 font-medium">Web Cam</p>
                        </div>
                        <div class="text-center">
                            <button onclick="toggleAudio()" class="p-3 rounded-full pastel-yellow text-pink-600 hover:scale-110 transition-all duration-300 cute-shadow" id="audioBtn">🎤</button>
                            <p class="text-xs text-pink-400 mt-1 font-medium">Speaker</p>
                        </div>
                        <div class="text-center">
                            <button onclick="shareScreen()" class="p-3 rounded-full pastel-peach text-pink-600 hover:scale-110 transition-all duration-300 cute-shadow">📺</button>
                            <p class="text-xs text-pink-400 mt-1 font-medium">Share</p>
                        </div>
                        <div class="text-center">
                            <button onclick="openWhiteboard()" class="p-3 rounded-full pastel-pink text-white hover:scale-110 transition-all duration-300 cute-shadow">🎨</button>
                            <p class="text-xs text-pink-400 mt-1 font-medium">Board</p>
                        </div>
                    </div>
                </div>

                <!-- Video Area -->
                <div id="videoArea" class="hidden p-4">
                    <div class="grid grid-cols-2 gap-4 h-64">
                        <div class="bg-black/20 rounded-2xl flex items-center justify-center relative overflow-hidden cute-shadow">
                            <video id="localVideo" class="w-full h-full object-cover rounded-2xl" muted autoplay playsinline></video>
                            <div class="absolute bottom-2 left-2 bg-black/70 text-white px-3 py-1 rounded-full text-sm font-medium">
                                <span class="bouncy mr-1">📹</span>
                                Kamu
                            </div>
                            <div class="absolute top-2 right-2 flex space-x-2">
                                <button onclick="toggleLocalVideo()" class="bg-black/50 hover:bg-black/70 text-white p-2 rounded-full transition-all duration-300" id="localVideoToggle">
                                    📹
                                </button>
                                <button onclick="toggleLocalAudio()" class="bg-black/50 hover:bg-black/70 text-white p-2 rounded-full transition-all duration-300" id="localAudioToggle">
                                    🎤
                                </button>
                            </div>
                        </div>
                        <div class="bg-black/20 rounded-2xl flex items-center justify-center relative cute-shadow">
                            <div class="text-white/60 text-center">
                                <div class="text-6xl mb-2 bouncy">📹</div>
                                <p class="font-medium">Menunggu teman bergabung...</p>
                                <p class="text-sm mt-2 opacity-75">Video call akan dimulai saat ada yang join</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chat Messages -->
                <div class="flex-1 p-4 overflow-y-auto" id="chatMessages">
                    <div class="text-center text-pink-400 py-8">
                        <div class="text-6xl mb-4 bouncy">💭</div>
                        <p class="flex items-center justify-center gap-2">
                            <span>Mulai percakapan seru dengan teman-temanmu!</span>
                            <span class="bouncy">✨</span>
                        </p>
                        <p class="text-sm mt-2 flex items-center justify-center gap-1">
                            <span>Tip: Ketik "konami" untuk surprise!</span>
                            <span class="bouncy">🎮</span>
                        </p>
                    </div>
                </div>

                <!-- Message Input -->
                <div class="p-4 glass-effect cute-shadow">
                    <div class="flex items-center space-x-3">
                        <button onclick="uploadFile()" class="p-3 rounded-full pastel-yellow text-pink-600 hover:scale-110 transition-all duration-300 cute-shadow bouncy">📎</button>
                        <input type="text" id="messageInput" placeholder="Ketik pesan kamu... 💕" 
                               class="flex-1 px-6 py-4 rounded-3xl bg-white/30 text-pink-700 placeholder-pink-400 border-2 border-pink-200 focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-pink-300 cute-shadow"
                               onkeypress="handleKeyPress(event)" onkeyup="checkEasterEgg(event)">
                        <button onclick="sendMessage()" class="p-3 rounded-full pastel-pink text-white hover:scale-110 transition-all duration-300 cute-shadow bouncy">🚀</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Add Friend Modal -->
    <div id="addFriendModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="glass-effect rounded-3xl p-6 w-full max-w-md mx-4 cute-shadow">
            <h3 class="text-2xl font-bold text-pink-600 mb-4 flex items-center gap-2">
                <span class="bouncy">👫</span>
                <span>Tambah Teman Baru</span>
            </h3>
            <div class="relative mb-4">
                <span class="absolute left-4 top-1/2 transform -translate-y-1/2 text-2xl">💌</span>
                <input type="email" id="friendEmail" placeholder="Email teman kamu" 
                       class="w-full pl-12 pr-4 py-4 rounded-3xl bg-white/30 text-pink-700 placeholder-pink-400 border-2 border-pink-200 focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-pink-300 cute-shadow">
            </div>
            <div class="flex space-x-3">
                <button onclick="addFriend()" class="flex-1 py-4 pastel-pink rounded-3xl text-white font-semibold hover:scale-105 transition-all duration-300 cute-shadow flex items-center justify-center gap-2">
                    <span>Tambah</span>
                    <span class="bouncy">✨</span>
                </button>
                <button onclick="closeModal('addFriendModal')" class="flex-1 py-4 pastel-yellow rounded-3xl text-pink-600 font-semibold hover:scale-105 transition-all duration-300 cute-shadow">Batal</button>
            </div>
        </div>
    </div>

    <!-- Whiteboard Modal -->
    <div id="whiteboardModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="bg-white rounded-3xl p-6 w-full max-w-4xl mx-4 h-3/4 cute-shadow">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-2xl font-bold text-pink-600 flex items-center gap-2">
                    <span class="bouncy">🎨</span>
                    <span>Whiteboard Kreatif</span>
                </h3>
                <button onclick="closeModal('whiteboardModal')" class="text-2xl hover:scale-110 transition-transform pastel-peach rounded-full p-2">❌</button>
            </div>
            <canvas id="whiteboard" class="w-full h-full border-2 border-pink-200 rounded-3xl cursor-crosshair cute-shadow"></canvas>
            <div class="flex items-center justify-center space-x-4 mt-4">
                <button onclick="changeColor('black')" class="w-10 h-10 bg-black rounded-full hover:scale-110 transition-transform cute-shadow"></button>
                <button onclick="changeColor('red')" class="w-10 h-10 bg-red-400 rounded-full hover:scale-110 transition-transform cute-shadow"></button>
                <button onclick="changeColor('blue')" class="w-10 h-10 bg-blue-400 rounded-full hover:scale-110 transition-transform cute-shadow"></button>
                <button onclick="changeColor('green')" class="w-10 h-10 bg-green-400 rounded-full hover:scale-110 transition-transform cute-shadow"></button>
                <button onclick="clearWhiteboard()" class="px-6 py-3 pastel-yellow text-pink-600 rounded-2xl font-semibold hover:scale-105 transition-all duration-300 cute-shadow flex items-center gap-2">
                    <span>Clear</span>
                    <span class="bouncy">✨</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentChat = null;
        let videoEnabled = false;
        let audioEnabled = false;
        let localStream = null;
        let konamiCode = [];
        let konamiSequence = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'KeyB', 'KeyA'];
        let whiteboardCtx = null;
        let isDrawing = false;
        let currentColor = 'black';

        // Sample messages for demo
        const sampleMessages = {
            'Luna': [
                { sender: 'Luna', message: 'Halo! Aku Luna, AI assistant kamu! 🤖✨', time: '08:00' },
                { sender: 'Luna', message: 'Aku bisa bantu kamu dengan berbagai hal seperti:', time: '08:00' },
                { sender: 'Luna', message: '• Menjawab pertanyaan 🤔\n• Membantu belajar 📚\n• Bercerita 📖\n• Bermain game kata 🎮\n• Dan masih banyak lagi!', time: '08:01' },
                { sender: 'Luna', message: 'Ada yang bisa aku bantu hari ini? 😊', time: '08:01' }
            ],
            'Sarah': [
                { sender: 'Sarah', message: 'Halo! Gimana kabarnya? 😊', time: '10:30' },
                { sender: 'me', message: 'Baik banget! Lagi ngapain?', time: '10:31' },
                { sender: 'Sarah', message: 'Lagi belajar nih, mau gabung study group?', time: '10:32' }
            ],
            'Alex': [
                { sender: 'Alex', message: 'Yo! Main game yuk nanti malam 🎮', time: '09:15' },
                { sender: 'me', message: 'Siap! Game apa?', time: '09:16' },
                { sender: 'Alex', message: 'Among Us atau Minecraft?', time: '09:17' }
            ]
        };

        function login(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            document.getElementById('currentUser').textContent = email.split('@')[0];
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            createSparkle('🎉');
        }

        function logout() {
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
            if (localStream) {
                localStream.getTracks().forEach(track => track.stop());
            }
        }

        function showAddFriend() {
            document.getElementById('addFriendModal').classList.remove('hidden');
        }

        function addFriend() {
            const email = document.getElementById('friendEmail').value;
            if (email) {
                // Demo: Add friend to list
                alert(`Undangan dikirim ke ${email}! 📧`);
                document.getElementById('friendEmail').value = '';
                closeModal('addFriendModal');
                createSparkle('👫');
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function startChat(friendName) {
            currentChat = friendName;
            document.getElementById('chatTitle').textContent = friendName;
            
            if (friendName === 'Luna') {
                document.getElementById('chatStatus').textContent = 'AI Assistant • Selalu siap membantu';
                document.getElementById('chatAvatar').textContent = '🤖';
            } else {
                document.getElementById('chatStatus').textContent = 'Online • Aktif sekarang';
                document.getElementById('chatAvatar').textContent = friendName === 'Sarah' ? '👩' : '👨';
            }
            
            // Load sample messages
            loadChatHistory(friendName);
        }

        function loadChatHistory(friendName) {
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.innerHTML = '';
            
            if (sampleMessages[friendName]) {
                sampleMessages[friendName].forEach(msg => {
                    addMessageToChat(msg.sender, msg.message, msg.time);
                });
            }
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (message && currentChat) {
                addMessageToChat('me', message);
                input.value = '';
                
                // Different responses for AI vs friends
                if (currentChat === 'Luna') {
                    setTimeout(() => {
                        const aiResponse = generateAIResponse(message);
                        addMessageToChat('Luna', aiResponse);
                    }, 800 + Math.random() * 1200);
                } else {
                    // Simulate friend response
                    setTimeout(() => {
                        const responses = [
                            'Haha iya betul! 😄',
                            'Setuju banget! ✨',
                            'Wah keren! 🔥',
                            'Oke siap! 👍',
                            'Mantap! 🚀'
                        ];
                        const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                        addMessageToChat(currentChat, randomResponse);
                    }, 1000 + Math.random() * 2000);
                }
            }
        }

        function generateAIResponse(userMessage) {
            const msg = userMessage.toLowerCase();
            
            // Greeting responses
            if (msg.includes('halo') || msg.includes('hai') || msg.includes('hello')) {
                const greetings = [
                    'Halo juga! Senang bertemu denganmu! 😊✨',
                    'Hai! Gimana kabarnya hari ini? 🌟',
                    'Hello! Ada yang bisa aku bantu? 🤖💕'
                ];
                return greetings[Math.floor(Math.random() * greetings.length)];
            }
            
            // Question responses
            if (msg.includes('apa') || msg.includes('bagaimana') || msg.includes('kenapa')) {
                const questions = [
                    'Pertanyaan yang menarik! 🤔 Bisa kamu jelaskan lebih detail?',
                    'Hmm, aku perlu tahu lebih banyak untuk bisa membantu dengan baik! 💭',
                    'Itu topik yang seru! Mari kita bahas lebih dalam 📚✨'
                ];
                return questions[Math.floor(Math.random() * questions.length)];
            }
            
            // Learning related
            if (msg.includes('belajar') || msg.includes('sekolah') || msg.includes('tugas')) {
                const learning = [
                    'Wah, semangat belajarnya! 📚 Mata pelajaran apa yang lagi kamu pelajari?',
                    'Aku suka bantu dengan belajar! Butuh penjelasan tentang apa? 🎓',
                    'Belajar itu seru! Ayo kita explore topik yang menarik! ✨📖'
                ];
                return learning[Math.floor(Math.random() * learning.length)];
            }
            
            // Fun responses
            if (msg.includes('main') || msg.includes('game') || msg.includes('bermain')) {
                const games = [
                    'Asyik! Mau main apa? Aku bisa main tebak-tebakan atau cerita! 🎮',
                    'Game seru nih! Gimana kalau kita main 20 pertanyaan? 🎯',
                    'Yuk main! Aku punya banyak ide game kata yang seru! 🎪✨'
                ];
                return games[Math.floor(Math.random() * games.length)];
            }
            
            // Default responses
            const defaults = [
                'Menarik sekali! Ceritakan lebih banyak dong! 😊',
                'Aku mengerti! Ada hal lain yang ingin kamu bahas? 💫',
                'Wah, itu keren! Gimana perasaanmu tentang itu? 🌟',
                'Aku suka ngobrol denganmu! Lanjut yuk! 💕',
                'Interesting! Aku penasaran dengan perspektif kamu! 🤖✨'
            ];
            return defaults[Math.floor(Math.random() * defaults.length)];
        }

        function addMessageToChat(sender, message, time = null) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            const currentTime = time || new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
            
            const isMe = sender === 'me';
            messageDiv.className = `chat-bubble mb-4 flex ${isMe ? 'justify-end' : 'justify-start'}`;
            
            messageDiv.innerHTML = `
                <div class="max-w-xs lg:max-w-md px-4 py-2 rounded-2xl ${isMe ? 'pastel-pink text-white' : 'bg-white/20 text-white'}">
                    <p class="text-sm">${message}</p>
                    <p class="text-xs opacity-70 mt-1">${currentTime}</p>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function checkEasterEgg(event) {
            const input = document.getElementById('messageInput');
            
            // Konami code easter egg
            konamiCode.push(event.code);
            if (konamiCode.length > konamiSequence.length) {
                konamiCode.shift();
            }
            
            if (JSON.stringify(konamiCode) === JSON.stringify(konamiSequence)) {
                createSparkle('🎮');
                input.value = 'Konami code activated! 🎉';
                konamiCode = [];
            }
            
            // Text easter eggs
            if (input.value.toLowerCase().includes('konami')) {
                createSparkle('🕹️');
            }
        }

        function toggleVideo() {
            videoEnabled = !videoEnabled;
            const videoArea = document.getElementById('videoArea');
            const videoBtn = document.getElementById('videoBtn');
            
            if (videoEnabled) {
                videoArea.classList.remove('hidden');
                videoBtn.style.background = 'rgba(34, 197, 94, 0.3)';
                startCamera();
            } else {
                videoArea.classList.add('hidden');
                videoBtn.style.background = 'rgba(255, 255, 255, 0.2)';
                stopCamera();
            }
        }

        function toggleAudio() {
            audioEnabled = !audioEnabled;
            const audioBtn = document.getElementById('audioBtn');
            
            if (audioEnabled) {
                audioBtn.style.background = 'rgba(34, 197, 94, 0.3)';
                audioBtn.textContent = '🎤';
            } else {
                audioBtn.style.background = 'rgba(255, 255, 255, 0.2)';
                audioBtn.textContent = '🔇';
            }
        }

        async function startCamera() {
            try {
                // Request camera and microphone access
                localStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        width: { ideal: 640 }, 
                        height: { ideal: 480 },
                        facingMode: 'user'
                    }, 
                    audio: true 
                });
                
                const localVideo = document.getElementById('localVideo');
                localVideo.srcObject = localStream;
                
                // Ensure video plays
                localVideo.onloadedmetadata = function() {
                    localVideo.play().catch(e => {
                        console.log('Video play failed:', e);
                    });
                };
                
                createSparkle('📹');
                
            } catch (error) {
                console.error('Camera access error:', error);
                let errorMessage = 'Tidak dapat mengakses kamera. ';
                
                if (error.name === 'NotAllowedError') {
                    errorMessage += 'Izin kamera ditolak. Silakan izinkan akses kamera di browser.';
                } else if (error.name === 'NotFoundError') {
                    errorMessage += 'Kamera tidak ditemukan.';
                } else if (error.name === 'NotReadableError') {
                    errorMessage += 'Kamera sedang digunakan aplikasi lain.';
                } else {
                    errorMessage += 'Error: ' + error.message;
                }
                
                alert(errorMessage);
            }
        }

        function stopCamera() {
            if (localStream) {
                localStream.getTracks().forEach(track => track.stop());
                localStream = null;
                document.getElementById('localVideo').srcObject = null;
            }
        }

        function toggleLocalVideo() {
            if (localStream) {
                const videoTrack = localStream.getVideoTracks()[0];
                if (videoTrack) {
                    videoTrack.enabled = !videoTrack.enabled;
                    const toggleBtn = document.getElementById('localVideoToggle');
                    toggleBtn.textContent = videoTrack.enabled ? '📹' : '📹❌';
                    toggleBtn.style.background = videoTrack.enabled ? 'rgba(0,0,0,0.5)' : 'rgba(239,68,68,0.7)';
                }
            }
        }

        function toggleLocalAudio() {
            if (localStream) {
                const audioTrack = localStream.getAudioTracks()[0];
                if (audioTrack) {
                    audioTrack.enabled = !audioTrack.enabled;
                    const toggleBtn = document.getElementById('localAudioToggle');
                    toggleBtn.textContent = audioTrack.enabled ? '🎤' : '🔇';
                    toggleBtn.style.background = audioTrack.enabled ? 'rgba(0,0,0,0.5)' : 'rgba(239,68,68,0.7)';
                }
            }
        }

        function shareScreen() {
            alert('Fitur share screen akan segera hadir! 📺');
            createSparkle('📺');
        }

        function openWhiteboard() {
            document.getElementById('whiteboardModal').classList.remove('hidden');
            initWhiteboard();
        }

        function initWhiteboard() {
            const canvas = document.getElementById('whiteboard');
            whiteboardCtx = canvas.getContext('2d');
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
        }

        function startDrawing(e) {
            isDrawing = true;
            const rect = e.target.getBoundingClientRect();
            whiteboardCtx.beginPath();
            whiteboardCtx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
        }

        function draw(e) {
            if (!isDrawing) return;
            const rect = e.target.getBoundingClientRect();
            whiteboardCtx.lineWidth = 3;
            whiteboardCtx.lineCap = 'round';
            whiteboardCtx.strokeStyle = currentColor;
            whiteboardCtx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
            whiteboardCtx.stroke();
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function changeColor(color) {
            currentColor = color;
        }

        function clearWhiteboard() {
            whiteboardCtx.clearRect(0, 0, whiteboardCtx.canvas.width, whiteboardCtx.canvas.height);
        }

        function uploadFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.multiple = true;
            input.accept = 'image/*,video/*,.pdf,.doc,.docx';
            
            input.onchange = function(e) {
                const files = Array.from(e.target.files);
                files.forEach(file => {
                    if (currentChat) {
                        addMessageToChat('me', `📎 ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`);
                    }
                });
                createSparkle('📎');
            };
            
            input.click();
        }

        function createRoom() {
            const roomName = prompt('Nama room baru:');
            if (roomName) {
                alert(`Room "${roomName}" berhasil dibuat! 🏠`);
                createSparkle('🏗️');
            }
        }

        function joinRoom(roomType) {
            const roomNames = {
                'study': 'Study Group 📚',
                'gaming': 'Gaming Squad 🎮'
            };
            
            currentChat = roomNames[roomType];
            document.getElementById('chatTitle').textContent = roomNames[roomType];
            document.getElementById('chatStatus').textContent = 'Room aktif • Bergabunglah dalam diskusi!';
            document.getElementById('chatAvatar').textContent = roomType === 'study' ? '📚' : '🎮';
            
            // Clear chat and show room welcome
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.innerHTML = '';
            addMessageToChat('System', `Selamat datang di ${roomNames[roomType]}! 🎉`);
        }

        function toggleSettings() {
            alert('Panel pengaturan akan segera hadir! ⚙️');
        }

        function createSparkle(emoji) {
            const sparkle = document.createElement('div');
            sparkle.className = 'easter-egg';
            sparkle.textContent = emoji;
            sparkle.style.left = Math.random() * window.innerWidth + 'px';
            sparkle.style.top = Math.random() * window.innerHeight + 'px';
            
            document.body.appendChild(sparkle);
            
            setTimeout(() => {
                document.body.removeChild(sparkle);
            }, 2000);
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Add some floating animations to elements
            setInterval(() => {
                const floatingElements = document.querySelectorAll('.floating');
                floatingElements.forEach(el => {
                    el.style.animationDelay = Math.random() * 2 + 's';
                });
            }, 5000);
            
            // Add random floating emojis
            const cuteEmojis = ['🌸', '🦋', '⭐', '🌙', '💫', '🎀', '🌺', '✨', '💕', '🌈'];
            setInterval(() => {
                if (Math.random() < 0.3) { // 30% chance every 3 seconds
                    const emoji = cuteEmojis[Math.floor(Math.random() * cuteEmojis.length)];
                    createSparkle(emoji);
                }
            }, 3000);
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96c6a68141c8e78d',t:'MTc1NDczNjE4NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
